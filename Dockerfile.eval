FROM python:3.11-slim

WORKDIR /evaluation

# Install system dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    git \
    && rm -rf /var/lib/apt/lists/*

# Copy project files
COPY pyproject.toml .
COPY evaluation/evaluate.py .

# Install dependencies with pip cache
RUN --mount=type=cache,target=/root/.cache/pip \
    pip install --no-cache-dir torch --index-url https://download.pytorch.org/whl/cpu && \
    pip install -e ".[eval]"

# Set the API URL as environment variable (can be overridden)
ENV API_URL=http://host.docker.internal:8000/api/detect

# Run evaluation
CMD ["python", "evaluate.py"]
